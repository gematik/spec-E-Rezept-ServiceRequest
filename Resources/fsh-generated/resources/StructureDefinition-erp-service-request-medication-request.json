{
  "resourceType": "StructureDefinition",
  "id": "erp-service-request-medication-request",
  "url": "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/erp-service-request-medication-request",
  "version": "1.2",
  "name": "ERPServiceRequestMedicationRequest",
  "title": "ERP Service Request Medication Request",
  "status": "draft",
  "experimental": false,
  "date": "2025-01-01",
  "publisher": "gematik GmbH",
  "description": "Medical and pharmaceutical information for the prescription request",
  "fhirVersion": "4.0.1",
  "kind": "resource",
  "abstract": false,
  "type": "MedicationRequest",
  "baseDefinition": "http://hl7.org/fhir/StructureDefinition/MedicationRequest",
  "derivation": "constraint",
  "differential": {
    "element": [
      {
        "id": "MedicationRequest.extension",
        "path": "MedicationRequest.extension",
        "comment": "If the previous recipe ID is known, it can be named here",
        "mustSupport": true
      },
      {
        "id": "MedicationRequest.extension:PriorPrescriptionID",
        "path": "MedicationRequest.extension",
        "sliceName": "PriorPrescriptionID",
        "short": "Provide a previous PrescriptionID that corresponds to the requested medication.",
        "definition": "\nThe MedicationRequest can contain a PrescriptionId of a prescription that has already been issued.\nIf a previous prescription ID is known, the writing system MAY indicate this in the medication request.\nIf this ID is available, the receiving system MUST be able to search for the previous regulation and give the user the opportunity to display and compare the content.\n",
        "comment": "Must be given in the form xxx.xxx.xxx.xxx.xxx.xx.",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/prescription-id-ex"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "MedicationRequest.extension:requestMVO",
        "path": "MedicationRequest.extension",
        "sliceName": "requestMVO",
        "short": "Multiple prescription order",
        "definition": "If the prescription is should be a multiple prescription order. Only the 'Kennzeichen' should be stated, indicating that the prescription is requested to be a multiple prescription order.",
        "comment": "When this extension is received by a PVS, the prescriber has to be visually notified about the request for a multiple prescription order.",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "https://fhir.kbv.de/StructureDefinition/KBV_EX_ERP_Multiple_Prescription"
            ]
          }
        ],
        "mustSupport": true,
        "isModifier": true
      },
      {
        "id": "MedicationRequest.extension:requestMVO.extension:Kennzeichen",
        "path": "MedicationRequest.extension.extension",
        "sliceName": "Kennzeichen",
        "mustSupport": true
      },
      {
        "id": "MedicationRequest.extension:requestMVO.extension:Nummerierung",
        "path": "MedicationRequest.extension.extension",
        "sliceName": "Nummerierung",
        "max": "0"
      },
      {
        "id": "MedicationRequest.extension:requestMVO.extension:Zeitraum",
        "path": "MedicationRequest.extension.extension",
        "sliceName": "Zeitraum",
        "max": "0"
      },
      {
        "id": "MedicationRequest.extension:requestMVO.extension:ID",
        "path": "MedicationRequest.extension.extension",
        "sliceName": "ID",
        "max": "0"
      },
      {
        "id": "MedicationRequest.extension:redeemByPatient",
        "path": "MedicationRequest.extension",
        "sliceName": "redeemByPatient",
        "short": "Redeem By Patient",
        "definition": "Indicates whether the prescription should be redeemed by the patient.",
        "comment": "This determines the Flow Type of the prescription to be set to 160/200 so that the patient can redeem the prescription himself.",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/prescription-id-ex"
            ]
          }
        ],
        "mustSupport": true,
        "isModifier": true
      },
      {
        "id": "MedicationRequest.medication[x]",
        "path": "MedicationRequest.medication[x]",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://fhir.kbv.de/StructureDefinition/KBV_PR_ERP_Medication_PZN",
              "https://fhir.kbv.de/StructureDefinition/KBV_PR_ERP_Medication_Compounding",
              "https://fhir.kbv.de/StructureDefinition/KBV_PR_ERP_Medication_Ingredient",
              "https://fhir.kbv.de/StructureDefinition/KBV_PR_ERP_Medication_FreeText"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "MedicationRequest.subject",
        "path": "MedicationRequest.subject",
        "short": "Patient for whom a dispense is requested on behalf of the patient.",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/erp-service-request-patient"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "MedicationRequest.dispenseRequest",
        "path": "MedicationRequest.dispenseRequest",
        "mustSupport": true
      },
      {
        "id": "MedicationRequest.dispenseRequest.quantity",
        "path": "MedicationRequest.dispenseRequest.quantity",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "MedicationRequest.dispenseRequest.quantity.value",
        "path": "MedicationRequest.dispenseRequest.quantity.value",
        "short": "Number of packs prescribed",
        "definition": "Number of packs prescribed",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "MedicationRequest.dispenseRequest.quantity.unit",
        "path": "MedicationRequest.dispenseRequest.quantity.unit",
        "max": "0"
      },
      {
        "id": "MedicationRequest.dispenseRequest.quantity.system",
        "path": "MedicationRequest.dispenseRequest.quantity.system",
        "min": 1,
        "fixedUri": "http://unitsofmeasure.org",
        "mustSupport": true
      },
      {
        "id": "MedicationRequest.dispenseRequest.quantity.code",
        "path": "MedicationRequest.dispenseRequest.quantity.code",
        "min": 1,
        "fixedCode": "{Package}",
        "mustSupport": true
      }
    ]
  }
}
