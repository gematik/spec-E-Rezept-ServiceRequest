{
  "resourceType": "StructureDefinition",
  "id": "gem-erp-sr-log-prescription-request",
  "url": "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/gem-erp-sr-log-prescription-request",
  "version": "1.2",
  "name": "GEM_ERP_SR_LOG_PrescriptionRequest",
  "title": "Logical Model Rezeptanforderung",
  "status": "draft",
  "experimental": false,
  "date": "2025-01-01",
  "publisher": "gematik GmbH",
  "description": "Fachliches Modell zur Beschreibung einer Rezeptanforderung",
  "fhirVersion": "4.0.1",
  "mapping": [
    {
      "identity": "Rezeptanforderung-Fachliches-Mapping",
      "name": "Rezeptanforderung Fachliches Mapping",
      "uri": "ERPServiceRequestPrescriptionRequest",
      "comment": "Mapping des Fachmodells aus GEM_ERP_SR_LOG_PrescriptionRequest auf das FHIR-Modell ERPServiceRequestPrescriptionRequest"
    },
    {
      "identity": "Quelle-Rezeptanforderung-Mapping",
      "name": "Quelle der Rezeptanforderungsinformationen",
      "comment": "Beschreibt die Quelle der Rezeptanforderungsinformationen"
    }
  ],
  "kind": "logical",
  "abstract": false,
  "type": "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/gem-erp-sr-log-prescription-request",
  "baseDefinition": "http://hl7.org/fhir/StructureDefinition/Element",
  "derivation": "specialization",
  "differential": {
    "element": [
      {
        "id": "gem-erp-sr-log-prescription-request",
        "path": "gem-erp-sr-log-prescription-request",
        "short": "Logical Model Rezeptanforderung",
        "definition": "Fachliches Modell zur Beschreibung einer Rezeptanforderung",
        "constraint": [
          {
            "key": "log-prescription-request-1",
            "severity": "error",
            "human": "Wenn eine Anfrage gestellt wird (status = 'active'), muss auch der Anfragende vorhanden sein.",
            "source": "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/gem-erp-sr-log-prescription-request"
          },
          {
            "key": "log-prescription-request-2",
            "severity": "error",
            "human": "Wenn eine Anfrage gestellt wird (status = 'active'), muss das Profil ERPMedicationRequest mit einer KBV_Medication genutzt werden.",
            "source": "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/gem-erp-sr-log-prescription-request"
          },
          {
            "key": "log-prescription-request-5",
            "severity": "error",
            "human": "Wenn eine Anfrage von einer Apotheke (involvierteParteien.Anfragender.AnfragenderTyp = 'APO') gestellt wird, muss die Angabe der Pflegeeinrichtung zur Kopie angegeben werden (involvierteParteien.PflegeeinrichtungKopie).",
            "source": "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/gem-erp-sr-log-prescription-request"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.MetaDaten",
        "path": "gem-erp-sr-log-prescription-request.MetaDaten",
        "short": "Metadaten im MessageHeader",
        "definition": "Metadaten im MessageHeader",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestDispenseRequestHeader"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Erstellendes PS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.MetaDaten.Empfaenger",
        "path": "gem-erp-sr-log-prescription-request.MetaDaten.Empfaenger",
        "short": "Empfänger der Nachricht",
        "definition": "Empfänger der Nachricht",
        "min": 1,
        "max": "*",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestDispenseRequestHeader.destination"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Aus Kontaktmanagement oder VZD Suche"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.MetaDaten.Empfaenger.KIMAdresse",
        "path": "gem-erp-sr-log-prescription-request.MetaDaten.Empfaenger.KIMAdresse",
        "short": "KIM-Adresse des Empfängers",
        "definition": "KIM-Adresse des Empfängers",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "url"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestDispenseRequestHeader.destination.endpoint"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Aus Kontaktmanagement oder VZD Suche"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.MetaDaten.Empfaenger.TelematikID",
        "path": "gem-erp-sr-log-prescription-request.MetaDaten.Empfaenger.TelematikID",
        "short": "Telematik-ID des Absenders",
        "definition": "Telematik-ID des Absenders",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "url"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestDispenseRequestHeader.destination.receiver.identifier.value"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Aus Kontaktmanagement oder VZD Suche"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.MetaDaten.Absender",
        "path": "gem-erp-sr-log-prescription-request.MetaDaten.Absender",
        "short": "Absender der Nachricht",
        "definition": "Absender der Nachricht",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestDispenseRequestHeader.sender"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Erstellendes PS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.MetaDaten.Absender.TelematikID",
        "path": "gem-erp-sr-log-prescription-request.MetaDaten.Absender.TelematikID",
        "short": "Telematik-ID des Absenders",
        "definition": "Telematik-ID des Absenders",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "url"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestDispenseRequestHeader.sender.identifier.value"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Erstellendes PS, SMC-B oder HBA Zertifikat"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.MetaDaten.Absender.Name",
        "path": "gem-erp-sr-log-prescription-request.MetaDaten.Absender.Name",
        "short": "Name des Absenders",
        "definition": "Name des Absenders",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestDispenseRequestHeader.sender.display"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Erstellendes PS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.MetaDaten.AbsendendesSystem",
        "path": "gem-erp-sr-log-prescription-request.MetaDaten.AbsendendesSystem",
        "short": "Absendendes System",
        "definition": "Absendendes System",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestDispenseRequestHeader.source"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Erstellendes PS",
            "comment": "Automatisiert durch Software gesetzt"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.MetaDaten.AbsendendesSystem.Name",
        "path": "gem-erp-sr-log-prescription-request.MetaDaten.AbsendendesSystem.Name",
        "short": "Name des Herstellers des absendenden Systems",
        "definition": "Name des Herstellers des absendenden Systems",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestDispenseRequestHeader.source.name"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Erstellendes PS",
            "comment": "Automatisiert durch Software gesetzt"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.MetaDaten.AbsendendesSystem.Software",
        "path": "gem-erp-sr-log-prescription-request.MetaDaten.AbsendendesSystem.Software",
        "short": "Name der Software des absendenden Systems",
        "definition": "Name der Software des absendenden Systems",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestDispenseRequestHeader.source.software"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Erstellendes PS",
            "comment": "Automatisiert durch Software gesetzt"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.MetaDaten.AbsendendesSystem.Version",
        "path": "gem-erp-sr-log-prescription-request.MetaDaten.AbsendendesSystem.Version",
        "short": "Version des absendenden Systems",
        "definition": "Version des absendenden Systems",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestDispenseRequestHeader.source.version"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Erstellendes PS",
            "comment": "Automatisiert durch Software gesetzt"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.MetaDaten.AbsendendesSystem.EMailKontakt",
        "path": "gem-erp-sr-log-prescription-request.MetaDaten.AbsendendesSystem.EMailKontakt",
        "short": "E-Mail-Kontakt des absendenden Systems",
        "definition": "E-Mail-Kontakt des absendenden Systems",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestDispenseRequestHeader.source.contact.value"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Erstellendes PS",
            "comment": "Automatisiert durch Software gesetzt"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.MetaDaten.AbsendendesSystem.Website",
        "path": "gem-erp-sr-log-prescription-request.MetaDaten.AbsendendesSystem.Website",
        "short": "Website des absendenden Systems",
        "definition": "Website des absendenden Systems",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "url"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestDispenseRequestHeader.source.endpoint"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Erstellendes PS",
            "comment": "Automatisiert durch Software gesetzt"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Status",
        "path": "gem-erp-sr-log-prescription-request.Status",
        "short": "Status",
        "definition": "Status der Anforderung. Wird genutzt, um den Bearbeitungsstand einer Anfrage zu verfolgen. Im Falle der Rezeptanforderung wird eine Anfrage mit dem Status 'active' erstellt und geschickt und signalisiert somit eine neue Anfrage.",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "code"
          }
        ],
        "constraint": [
          {
            "key": "log-prescription-request-1",
            "severity": "error",
            "human": "Wenn eine Anfrage gestellt wird (status = 'active'), muss auch der Anfragende vorhanden sein.",
            "source": "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/gem-erp-sr-log-prescription-request"
          },
          {
            "key": "log-prescription-request-2",
            "severity": "error",
            "human": "Wenn eine Anfrage gestellt wird (status = 'active'), muss das Profil ERPMedicationRequest mit einer KBV_Medication genutzt werden.",
            "source": "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/gem-erp-sr-log-prescription-request"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.status"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS",
            "comment": "Setzt den Status der Anfrage auf 'active'"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.VorgangsID",
        "path": "gem-erp-sr-log-prescription-request.VorgangsID",
        "short": "ID des Vorgangs",
        "definition": "Wird vom initialen Sender gesetzt und muss immer mitgeführt werden.",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.identifier:requestId.value"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS",
            "comment": "Erzeugt einen Vorgang und generiert eine VorgangsID"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien",
        "short": "Involvierte Parteien",
        "definition": "Angaben zu den involvierten Parteien",
        "min": 1,
        "max": "*",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.subject/performer/requester"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": ""
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.PatientenInformationen",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.PatientenInformationen",
        "short": "Patienteninformationen",
        "definition": "Angaben zum Patienten",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.subject(ERPServiceRequestPatient)"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS",
            "comment": "Abfrage aus Stammdatenmanagement"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.PatientenInformationen.PatientenIdentifierKVNR",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.PatientenInformationen.PatientenIdentifierKVNR",
        "short": "KVNR des Patienten",
        "definition": "KVNR des Patienten",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPatient.identifier.value"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.PatientenInformationen.PatientenName",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.PatientenInformationen.PatientenName",
        "short": "Name des Patienten",
        "definition": "Strukturierte Angabe des Namens des Patienten",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "HumanName"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPatient.name"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.PatientenInformationen.PatientenGeburtstag",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.PatientenInformationen.PatientenGeburtstag",
        "short": "Geburtstag des Patienten",
        "definition": "Angabe des Geburtstags mit Jahr, Monat und Tag",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "date"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPatient.birthDate"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.VerordnenderArzt",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.VerordnenderArzt",
        "short": "Verordnender Arzt",
        "definition": "Angaben zum verordnenden Arzt. Anzugeben, wenn ein Arzt zur Ausstellung identifiziert werden kann.",
        "min": 0,
        "max": "*",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.performer(ERPServiceRequestPractitioner)"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS",
            "comment": "Falls vorher bekannt aus Kontaktmanagement oder vorheriger RezeptID"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.VerordnenderArzt.LANR",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.VerordnenderArzt.LANR",
        "short": "LANR des Arztes",
        "definition": "LANR des Arztes",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPractitioner.identifier.value"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.VerordnenderArzt.Name",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.VerordnenderArzt.Name",
        "short": "Name des Arztes",
        "definition": "Name des Arztes",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "HumanName"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPractitioner.name"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.Anfragender",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.Anfragender",
        "short": "Anfragender",
        "definition": "Angaben zum anfragenden",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "constraint": [
          {
            "key": "log-prescription-request-1",
            "severity": "error",
            "human": "Wenn eine Anfrage gestellt wird (status = 'active'), muss auch der Anfragende vorhanden sein.",
            "source": "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/gem-erp-sr-log-prescription-request"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.requester(ERPServiceRequestOrganization)"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.Anfragender.AnfragenderTyp",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.Anfragender.AnfragenderTyp",
        "short": "Typ des Anfragenden",
        "definition": "Folgende Typen sind zulässig: Apotheke, Pflegeeinrichtung",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "Coding"
          }
        ],
        "constraint": [
          {
            "key": "log-prescription-request-5",
            "severity": "error",
            "human": "Wenn eine Anfrage von einer Apotheke (involvierteParteien.Anfragender.AnfragenderTyp = 'APO') gestellt wird, muss die Angabe der Pflegeeinrichtung zur Kopie angegeben werden (involvierteParteien.PflegeeinrichtungKopie).",
            "source": "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/gem-erp-sr-log-prescription-request"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.Anfragender.Name",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.Anfragender.Name",
        "short": "Name des Anfragenden",
        "definition": "Name des Anfragenden",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestOrganization.name"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.Anfragender.Adresse",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.Anfragender.Adresse",
        "short": "Straßenadresse des Anfragenden",
        "definition": "Straßenadresse des Anfragenden",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Address"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestOrganization.address"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.Anfragender.Telefon",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.Anfragender.Telefon",
        "short": "Telefonnummer des Anfragenden",
        "definition": "Telefonnummer des Anfragenden",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestOrganization.contact.telecom:tel.value"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.PflegeeinrichtungKopie",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.PflegeeinrichtungKopie",
        "short": "Zu benachrichtigende Pflegeeinrichtung",
        "definition": "Angaben zur Pflegeeinrichtung, die über den Ablauf der Rezeptanforderung per Kopie informiert werden soll. Muss angegeben werden, wenn die Apotheke die Rezeptanforderung stellt.",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "constraint": [
          {
            "key": "log-prescription-request-5",
            "severity": "error",
            "human": "Wenn eine Anfrage von einer Apotheke (involvierteParteien.Anfragender.AnfragenderTyp = 'APO') gestellt wird, muss die Angabe der Pflegeeinrichtung zur Kopie angegeben werden (involvierteParteien.PflegeeinrichtungKopie).",
            "source": "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/gem-erp-sr-log-prescription-request"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.supportingInfo:pflegeeinrichtungKopie(ERPServiceRequestOrganization)"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes AVS",
            "comment": "Im Fall, dass die Apotheke die Anfrage initiiert"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.PflegeeinrichtungKopie.Name",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.PflegeeinrichtungKopie.Name",
        "short": "Name der Pflegeeinrichtung",
        "definition": "Name der Pflegeeinrichtung",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestOrganization.name"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes AVS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.PflegeeinrichtungKopie.Telefon",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.PflegeeinrichtungKopie.Telefon",
        "short": "Telefonnummer der Pflegeeinrichtung",
        "definition": "Telefonnummer der Pflegeeinrichtung",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestOrganization.contact.telecom:tel.value"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes AVS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.involvierteParteien.PflegeeinrichtungKopie.KIMAdresse",
        "path": "gem-erp-sr-log-prescription-request.involvierteParteien.PflegeeinrichtungKopie.KIMAdresse",
        "short": "KIM-Adresse der Pflegeeinrichtung",
        "definition": "KIM-Adresse der Pflegeeinrichtung",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "Address"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestOrganization.contact.telecom:kim.value"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes AVS"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Freitext",
        "path": "gem-erp-sr-log-prescription-request.Freitext",
        "short": "Freitext",
        "definition": "Individuelle Nachricht an den Empfänger",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.note"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Nutzer des PS",
            "comment": "Abfrage im Moment der Anforderung"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.GrundDerAnforderung",
        "path": "gem-erp-sr-log-prescription-request.GrundDerAnforderung",
        "short": "Grund der Anforderung",
        "definition": "Entweder Codiert oder als Freitext",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.reasonCode"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Nutzer des PS",
            "comment": "Abfrage im Moment der Anforderung"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.GrundDerAnforderung.GrundCode",
        "path": "gem-erp-sr-log-prescription-request.GrundDerAnforderung.GrundCode",
        "short": "Code des Grundes",
        "definition": "Folgende Gründe sind vorgesehen: Korrektur, Reichweite erschöpft(Dauermedikation), nach Vitalwertmessung, nach Bedarf (z.B. aufgrund von Schmerzen)",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Coding"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.reasonCode.coding"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Nutzer des PS",
            "comment": "Abfrage im Moment der Anforderung"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.GrundDerAnforderung.GrundText",
        "path": "gem-erp-sr-log-prescription-request.GrundDerAnforderung.GrundText",
        "short": "Text des Grundes",
        "definition": "Text des Grundes",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.reasonCode.text"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Nutzer des PS",
            "comment": "Abfrage im Moment der Anforderung"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Prioritaet",
        "path": "gem-erp-sr-log-prescription-request.Prioritaet",
        "short": "Priorität",
        "definition": "Angabe der Priorität der Anforderung",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.priority"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Nutzer des PS",
            "comment": "Abfrage im Moment der Anforderung"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Prioritaet.PrioritaetCode",
        "path": "gem-erp-sr-log-prescription-request.Prioritaet.PrioritaetCode",
        "short": "Priorität der Anforderung",
        "definition": "Folgende Prioritäten sind zulässig: Hoch, Normal",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "Coding"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.priority"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Nutzer des PS",
            "comment": "Abfrage im Moment der Anforderung"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Restreichweite",
        "path": "gem-erp-sr-log-prescription-request.Restreichweite",
        "short": "Restreichweite",
        "definition": "Angabe der Restreichweite",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.reasonCode.extension:remainingSupply"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS oder Nutzer des PS",
            "comment": "Abfrage/ Eingabe im Moment der Anforderung"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Restreichweite.Freitext",
        "path": "gem-erp-sr-log-prescription-request.Restreichweite.Freitext",
        "short": "Restreichweite in Tage oder Anzahl an Einheiten",
        "definition": "Restreichweite in Tage oder Anzahl an Einheiten",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.reasonCode.extension:remainingSupplyFreeText.valueString"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Nutzer des PS",
            "comment": "Abfrage im Moment der Anforderung"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Restreichweite.Einheit",
        "path": "gem-erp-sr-log-prescription-request.Restreichweite.Einheit",
        "short": "Einheit der Restreichweite",
        "definition": "Einheit der Restreichweite",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.reasonCode.extension:remainingSupply.unit"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS",
            "comment": "Ggf. automatisierte Berechnung"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Restreichweite.Wert",
        "path": "gem-erp-sr-log-prescription-request.Restreichweite.Wert",
        "short": "Wert der Restreichweite",
        "definition": "Wert der Restreichweite",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "decimal"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.reasonCode.extension:remainingSupply.value"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS",
            "comment": "Ggf. automatisierte Berechnung"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Anhaenge",
        "path": "gem-erp-sr-log-prescription-request.Anhaenge",
        "short": "Anhänge",
        "definition": "Anhänge zur Anforderung. Das können PDFs, Bilder oder andere Dokumente sein.",
        "comment": "Werden auf Ebene der KIM-Nachricht angehangen",
        "min": 0,
        "max": "*",
        "type": [
          {
            "code": "Attachment"
          }
        ],
        "mapping": [
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS oder Nutzer des PS",
            "comment": "Generierung oder Bereitstellung im Moment der Anforderung"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Medikation",
        "path": "gem-erp-sr-log-prescription-request.Medikation",
        "short": "Medikation",
        "definition": "Angaben zur Medikation",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "constraint": [
          {
            "key": "log-prescription-request-2",
            "severity": "error",
            "human": "Wenn eine Anfrage gestellt wird (status = 'active'), muss das Profil ERPMedicationRequest mit einer KBV_Medication genutzt werden.",
            "source": "https://gematik.de/fhir/erp-servicerequest/StructureDefinition/gem-erp-sr-log-prescription-request"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestPrescriptionRequest.basedOn(ERPServiceRequestMedicationRequest)"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS oder Nutzer des PS",
            "comment": "Bereitstellung aus Medikamentenmanagement"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Medikation.VorherigeRezeptID",
        "path": "gem-erp-sr-log-prescription-request.Medikation.VorherigeRezeptID",
        "short": "ID des vorherigen Rezepts",
        "definition": "Kann bei der Anforderung einer Folgeverordnung verwendet werden, um einen Bezug zu einer vorherigen Verordnung herzustellen.",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestMedicationRequest.extension:PriorPrescriptionID.valueIdentifier.value"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS",
            "comment": "Kann aus dem Medikamentenmanagement abgefragt werden"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Medikation.MedikationsReferenz",
        "path": "gem-erp-sr-log-prescription-request.Medikation.MedikationsReferenz",
        "short": "Referenz auf das Medikamentenobjekt",
        "definition": "Referenz auf das Medikamentenobjekt nach KBV_Verordnung (Freitext, PZN, Wirkstoff, Rezeptur)",
        "comment": "Folgende Profile aus dem E-Rezept Verordnungsdatensatz sind zulässig: KBV_PR_ERP_Medication_Compounding, KBV_PR_ERP_Medication_FreeText, KBV_PR_ERP_Medication _Ingredient, KBV_PR_ERP_Medication_PZN",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Medication"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestMedicationRequest.medication"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS",
            "comment": "Bereitstellung aus Medikamentenmanagement"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Medikation.AnzahlPackungen",
        "path": "gem-erp-sr-log-prescription-request.Medikation.AnzahlPackungen",
        "short": "Anzahl der Packungen",
        "definition": "Anzahl der Packungen",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "BackboneElement"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestMedicationRequest.dispenseReques.quantity"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS oder Nutzer des PS",
            "comment": "Bereitstellung aus Medikamentenmanagement"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Medikation.AnzahlPackungen.Einheit",
        "path": "gem-erp-sr-log-prescription-request.Medikation.AnzahlPackungen.Einheit",
        "short": "Einheit der Menge, fix auf 'Packung' gesetzt",
        "definition": "Einheit der Menge, fix auf 'Packung' gesetzt",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestMedicationRequest.dispenseRequest.quantity.code"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS",
            "comment": "Bereitstellung aus Medikamentenmanagement"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Medikation.AnzahlPackungen.Wert",
        "path": "gem-erp-sr-log-prescription-request.Medikation.AnzahlPackungen.Wert",
        "short": "Anzahl der Packungen",
        "definition": "Anzahl der Packungen",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "string"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestMedicationRequest.dispenseRequest.quantity.value"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Anfragendes PS oder Nutzer des PS",
            "comment": "Bereitstellung aus Medikamentenmanagement"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Medikation.VersichertenEinloesung",
        "path": "gem-erp-sr-log-prescription-request.Medikation.VersichertenEinloesung",
        "short": "Versicherten Einlösung",
        "definition": "Angabe, ob der Versicherte das E-Rezept selbst einlösen möchte.",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "boolean"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestMedicationRequest.extension:redeemByPatient.valueBoolean"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Nutzer des PS",
            "comment": "Angabemöglichkeit im Moment der Anforderung"
          }
        ]
      },
      {
        "id": "gem-erp-sr-log-prescription-request.Medikation.AngabeMVO",
        "path": "gem-erp-sr-log-prescription-request.Medikation.AngabeMVO",
        "short": "Angabe MVO",
        "definition": "Angabe, ob der anfordernde eine MVO wünscht. Es obliegt dem Verordnenden dem Wunsch nachzukommen. Der verordnende LE entscheidet über die Menge und die Zeiträume",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "boolean"
          }
        ],
        "mapping": [
          {
            "identity": "Rezeptanforderung-Fachliches-Mapping",
            "map": "ERPServiceRequestMedicationRequest.extension:requestMVO.extension:Kennzeichen.valueBoolean"
          },
          {
            "identity": "Quelle-Rezeptanforderung-Mapping",
            "map": "Nutzer des PS",
            "comment": "Angabemöglichkeit im Moment der Anforderung. Unterstützung ggf. durch PS."
          }
        ]
      }
    ]
  }
}
