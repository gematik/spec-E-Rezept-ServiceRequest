@startuml


skinparam maxMessageSize 300

title Ablauf für Rezeptabgabe parenteraler Zubereitungen
hide footbox
autonumber

box "Apotheke" #White
    participant "Taxierungssoftware, Zytostatika-Programm" as AVS
end box

box "LEI des Verordnenden" #White
    participant "Primärsystem" as PS
    actor "Verordnender \nLeistungserbringer" as Arzt
end box

legend bottom right
    __Legende__
    |<#PaleGreen> Ergebnis: Zubereitungs-/Medikamentabgabe|
    |<#LightPink> Ergebnis: keine Zubereitungs-/Medikamentabgabe|
    **lfd.Nr.** //Informationseinheit als Nachricht übermittelt//
    **lfd.Nr.** **sonstige Aktivität**
endlegend

?-> AVS: Start der \nZubereitung

AVS ->> AVS: Zubereitungsdaten

AVS ->> PS: //Rezeptanforderung//

break #LightPink Stornierung notwendig
    AVS ->> PS: //Rezeptanforderung_Storno//
    PS ->x PS: **Rezeptanforderung wird verworfen**
    PS ->> AVS: //Rezeptanforderung_Storno//
end

PS ->> PS: **Arbeitslisteneintrag erzeugen und vorhalten**

PS ->> Arzt: **Rezeptanforderung präsentieren**
return :Rezeptzustimmung ODER :Rezeptablehnung

alt #PaleGreen Arzt stimmt Rezeptanforderung zu
    ref over Arzt, PS #lightyellow
        E-Rezept einstellen
    end ref
    PS ->> AVS: //Rezeptanforderung_Bestätigung//
else #LightPink Arzt lehnt Rezeptanforderung ab
    PS ->> AVS: //Rezeptanforderung_Storno//

end

@enduml