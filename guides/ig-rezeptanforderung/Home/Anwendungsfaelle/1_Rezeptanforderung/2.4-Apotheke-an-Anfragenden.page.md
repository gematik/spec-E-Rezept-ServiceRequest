## {{page-title}}

### [8] Dispensieranforderung_Bestätigung

Abschließend zum Anwendungsfall übermittelt die Apotheke eine Bestätigung an die anfragende Pflegeeinrichtung, dass die Abgabe bestätigt ist.
In der Antwort sollen auch die Abgabedaten inkludiert sein, damit der Anfragende informiert ist welches Präparat geliefert wird.

#### Fachliches Mapping
Die Bestätigung der Dispensieranforderung enthält im wesentlichen folgende Informationen:
* MetaDaten zur Nachricht
* Involvierte Parteien
* Weitere Informationen

Das Mapping dieser fachlichen Informationen aus dem Logical Model zu den konkreten Profilen kann unter {{pagelink:Home/Datenobjekte/Mappings/mapping_definitions/Mapping-für-Dispensieranforderung.page.md}} eingesehen werden.

Entsprechend der Informationen und Kardinalitäten sind die Profile zu befüllen.

#### Verwendung von Profilen

Folgende Profile sind für diesen Übertragungsweg zu nutzen und im {{link:https://gematik.de/fhir/erp-servicerequest/StructureDefinition/erp-service-request-message-container}} einzubetten:

|Profil|Referenziert in|Optional|
|---|---|---|
|{{pagelink:Home/Datenobjekte/Profile/profile_definitions/erp-service-request-request-header.page.md}}|ERPServiceRequestMessageContainer.entry[0]||
|{{pagelink:Home/Datenobjekte/Profile/profile_definitions/erp-service-request-dispense-request.page.md}}|ERPServiceRequestRequestHeader.focus||
|{{pagelink:Home/Datenobjekte/Profile/profile_definitions/erp-service-request-patient.page.md}}|ERPServiceRequestDispenseRequest.subject||
|{{pagelink:Home/Datenobjekte/Profile/profile_definitions/erp-service-request-medication-request.page.md}}|ERPServiceRequestDispenseRequest.basedOn||
|[KBV_PR_ERP_Medication_PZN](https://simplifier.net/erezept/kbvprerpmedicationpzn), [KBV_PR_ERP_Medication_Compounding](https://simplifier.net/erezept/kbvprerpmedicationcompounding), [KBV_PR_ERP_Medication_Ingredient](https://simplifier.net/erezept/kbvprerpmedicationingredient), [KBV_PR_ERP_Medication_FreeText](https://simplifier.net/erezept/kbvprerpmedicationfreetext)|ERPServiceRequestMedicationRequest.medication[x]||

Folgendes Klassendiagramm soll die verwendeten Profile graphisch darstellen:
{{render:guides/ig-rezeptanforderung/images/puml_images/DispenseRequest_Confirmation_Class.png}}

#### Voraussetzungen

Folgende Bedingungen müssen erfüllt, bzw. Felder gesetzt sein, damit die Nachricht einer Dispensieranforderung entspricht:

|Profil|Bedingung|
|---|---|
|ERPServiceRequestRequestHeader|.eventCode = `#eRezept_Rezeptanforderung;Abgabebestaetigung`|
|ERPServiceRequestDispenseRequest|.status = #completed|

Folgende FHIR-Constraints wurden für das Profil `ERPServiceRequestDispenseRequest` im Rahmen einer Dispensieranforderung gesetzt:

@```
from
	StructureDefinition
where
	name = 'ERPServiceRequestDispenseRequest'
for differential.element where constraint.exists()
select
    'Feld': id,
    join for constraint.where(expression.startsWith('status = \'completed\'')) select { Condition: human }
```

### Ergebnis

Die anfragende Einrichtung/ Person ist darüber informiert, dass die Abgabe erfolgt ist und welche Medikamente geliefert werden.
Dieser letzte Schritt schließt den Anwendungsfall ab.
