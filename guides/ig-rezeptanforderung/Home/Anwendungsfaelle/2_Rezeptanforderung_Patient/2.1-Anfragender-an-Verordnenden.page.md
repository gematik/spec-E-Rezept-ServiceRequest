## {{page-title}}

In diesem Anwendungsfall erstellt die Pflegeeinrichtung im Namen des Patienten eine Rezeptanforderung mit der Kennzeichnung zur Patienteneinlösung an einen verordnenden Leistungserbringer. Der verordnende LE stellt ein E-Rezept am E-Rezept-Fachdienst ein und überträgt den E-Rezept Token als Antwort an die Pflegeeinrichtung.
Die Pflegeeinrichtung kann nun optional den Versicherten über die Ausstellung des E-Rezeptes informieren.

{{render:guides/ig-rezeptanforderung/images/puml_images/UC2.png}}

In der Rezeptanforderung sind medizinische Informationen zum angefragten Arzneimittel, wie auch administrative Informationen enthalten.
Die folgenden Beschreibungen liefern detailiierte Informationen, wie eine Rezeptanforderung zu befüllen und auszuführen ist.

### [1] Rezeptanforderung

#### Fachliches Mapping
Die Rezeptanforderung enthält im wesentlichen folgende Informationen:
* MetaDaten zur Nachricht
* Involvierte Parteien
* Angaben zur Medikation
* Weitere Informationen

Das Mapping dieser fachlichen Informationen aus dem Logical Model zu den konkreten Profilen kann unter {{pagelink:Home/Datenobjekte/Mappings/mapping_definitions/Mapping-für-Rezeptanforderung.page.md}} eingesehen werden.

Entsprechend der Informationen und Kardinalitäten sind die Profile zu befüllen.

#### Verwendung von Profilen

Folgende Profile sind für diesen Übertragungsweg zu nutzen und im {{link:https://gematik.de/fhir/erp-servicerequest/StructureDefinition/erp-service-request-message-container}} einzubetten:

|Profil|Referenziert in|Optional|
|---|---|---|
|{{pagelink:Home/Datenobjekte/Profile/profile_definitions/erp-service-request-request-header.page.md}}|ERPServiceRequestMessageContainer.entry[0]||
|{{pagelink:Home/Datenobjekte/Profile/profile_definitions/erp-service-request-prescription-request.page.md}}|ERPServiceRequestRequestHeader.focus||
|{{pagelink:Home/Datenobjekte/Profile/profile_definitions/erp-service-request-patient.page.md}}|ERPServiceRequestPrescriptionRequest.subject||
|{{pagelink:Home/Datenobjekte/Profile/profile_definitions/erp-service-request-organization.page.md}}, |ERPServiceRequestPrescriptionRequest.requester||
|{{pagelink:Home/Datenobjekte/Profile/profile_definitions/erp-service-request-practitioner.page.md}} |ERPServiceRequestPrescriptionRequest.performer|x|
|{{pagelink:Home/Datenobjekte/Profile/profile_definitions/erp-service-request-medication-request.page.md}}|ERPServiceRequestPrescriptionRequest.basedOn||
|[KBV_PR_ERP_Medication_PZN](https://simplifier.net/erezept/kbvprerpmedicationpzn), [KBV_PR_ERP_Medication_Compounding](https://simplifier.net/erezept/kbvprerpmedicationcompounding), [KBV_PR_ERP_Medication_Ingredient](https://simplifier.net/erezept/kbvprerpmedicationingredient), [KBV_PR_ERP_Medication_FreeText](https://simplifier.net/erezept/kbvprerpmedicationfreetext)|ERPServiceRequestMedicationRequest.medication[x]||

Folgendes Klassendiagramm soll die verwendeten Profile graphisch darstellen:
{{render:guides/ig-rezeptanforderung/images/puml_images/PrescriptionRequest_Class.png}}

#### Voraussetzungen

Folgende Bedingungen müssen erfüllt, bzw. Felder gesetzt sein, damit die Nachricht einer Rezeptanforderung entspricht:

|Profil|Bedingung|
|---|---|
|ERPServiceRequestRequestHeader|.eventCode = `#eRezept_Rezeptanforderung;Rezeptanfrage`|
|ERPServiceRequestPrescriptionRequest|.status = #active|
|ERPServiceRequestPrescriptionRequest|.requester.type = #PFL \| #APO|
|ERPServiceRequestMedicationRequest|.extension:redeemByPatient = **true**|

Folgende FHIR-Constraints wurden für das Profil `ERPServiceRequestPrescriptionRequest` im Rahmen einer Rezeptanforderung gesetzt:

@```
from
	StructureDefinition
where
	name = 'ERPServiceRequestPrescriptionRequest'
for differential.element where constraint.exists()
select
    'Feld': id,
    join for constraint.where(expression.startsWith('status = \'active\'')) select { Condition: human }
```

Über `ServiceRequest.reasonCode` und `ServiceRequest.reasonReference` kann angegeben werden, warum die Medikation angefragt wird.

#### Angabe der Verordnungsinhalte

Die MedicationRequest Ressource ist nach Profil {{pagelink:Home/Datenobjekte/Profile/profile_definitions/erp-service-request-medication-request.page.md}} anzugeben.
Zur Behandlung von gesonderten Fällen kann in der MedicationRequest Ressource folgendes gesetzt werden: 

|Feld|Bedeutung|
|---|---|
|.extension:PriorPrescriptionID|Angabe einer vorherigen Task ID auf die sich die Anfrage bezieht|
|.extension:requestMVO.extension:Kennzeichen|Angabe, ob der Anfragende die Ausstellung des E-Rezeptes im Rahmen einer Mehrfachverordnung wünscht|
|.extension:redeemByPatient|Angabe, ob die angefragte Verordnung durch den Versicherten eingelöst werden soll. Hier muss der verordnende das E-Rezept mit Workflow 160/169 erstellen.|
|.dispenseRequest.quantity|Angabe der gewünschten Packungsmenge des Arzneimittels|

### Stornierung - Verordnungsanfrage

**MessageHeader.eventCode:** #eRezept_Rezeptanforderung;Rezeptanfrage_Storno

Falls der Anfragende die Anfrage stornieren möchte, wird der gleiche ServiceRequest (.identifer:requestId muss gleich sein) erneut an den Verordnenden versendet und

* .status = #entered-in-error

angegeben. Hierzu kann ebenfalls ein Grund unter `ServiceRequest.reasonCode` angegeben werden.

### Ergebnis der Übertragung

Im Falle der erfolgreichen Übertragung sollte der Verordnende alle wesentlichen Informationen zur Verfügung haben, die er für das Ausstellen einer Verordnung benötigt:

* Daten des Patienten, für den die Verordnung erstellt werden soll
* Daten des Anfragenden, an den die Informationen übertragen werden sollen
* Daten zum angefragten Medikament, dass verordnet werden soll
* Optional der Grund und/ oder die Reichweite der aktuellen Medikation
